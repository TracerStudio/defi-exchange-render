# Використовуємо Node.js 18 LTS як базовий образ
FROM node:18-alpine

# Встановлюємо робочу директорію
WORKDIR /app

# Копіюємо package.json для фронтенду
COPY frontend-package.json package.json

# Очищаємо кеш npm та встановлюємо залежності
RUN npm cache clean --force && npm install --legacy-peer-deps

# Копіюємо файли фронтенду
COPY src/ src/
COPY public/ public/

# Збираємо React додаток
RUN npm run build

# Встановлюємо nginx для обслуговування статичних файлів
FROM nginx:alpine

# Копіюємо зібраний додаток
COPY --from=0 /app/build /usr/share/nginx/html

# Копіюємо конфігурацію nginx
COPY nginx.conf /etc/nginx/nginx.conf

# Відкриваємо порт
EXPOSE 80

# Запускаємо nginx
CMD ["nginx", "-g", "daemon off;"]
